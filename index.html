<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Abdul Hadi Fast Food</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
 :root{
   --bg:#fbf7f2;
   --card:#fff;
   --maroon:#7a0f0f;
   --accent:#b22222;
   --muted:#6b6b6b;
   --green:#25D366;
 }
 *{box-sizing:border-box;font-family:"Poppins",sans-serif}
 body{margin:0;background:var(--bg);color:#222}
 header{
   display:flex;align-items:center;gap:12px;padding:18px 16px;background:#fff;border-bottom:4px solid #eee;
   position:sticky;top:0;z-index:2000;
}
.header-logo{height:56px;width:56px;border-radius:8px;object-fit:cover}
.header-title{font-size:22px;font-weight:800;color:var(--maroon);letter-spacing:0.5px}
.header-sub{font-size:12px;color:var(--muted)}
.container{max-width:1100px;margin:14px auto;padding:0 14px}

/* hero replaced with big name only */
.hero-title{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.name-big{font-size:28px;font-weight:800;color:var(--maroon)}
.small-actions{display:flex;gap:8px;align-items:center}

/* categories nav */
.categories{display:flex;gap:8px;overflow:auto;padding:10px 0 6px}
.cat-btn{
  background:#fff;border:1px solid #eee;padding:10px 14px;border-radius:999px;min-width:110px;text-align:center;
  font-weight:600;color:var(--maroon);cursor:pointer;flex:0 0 auto;transition:transform .15s,box-shadow .15s;
}
.cat-btn:active{transform:translateY(2px)}
.banner-section{
  display:flex;align-items:center;justify-content:center;margin:14px 0 8px;
}

/* section heading with maroon small banner */
.section-title{
  text-align:center;margin:18px 0 8px;
}
.section-title .title{
  display:inline-block;background:linear-gradient(90deg,var(--maroon),#9b1d1d);color:#fff;padding:10px 18px;border-radius:6px;font-weight:800;
  font-size:20px;
}

/* grid */
.grid{
  display:grid;grid-template-columns:repeat(3,1fr);gap:14px;
}
@media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:420px){.grid{grid-template-columns:repeat(2,1fr);gap:10px} .header-title{font-size:18px} .name-big{font-size:20px}}

/* card */
.card{background:var(--card);border-radius:12px;padding:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06);display:flex;flex-direction:column;gap:8px}
.card img{width:100%;height:120px;object-fit:cover;border-radius:8px}
.card .name{font-weight:700;font-size:15px}
.card .price{color:var(--accent);font-weight:800}
.controls{display:flex;gap:8px;align-items:center;justify-content:center}
.qty-btn{width:36px;height:36px;border-radius:8px;border:none;background:var(--maroon);color:#fff;font-weight:800;cursor:pointer;transition:transform .12s}
.qty-btn:active{transform:scale(.98)}
.qty-display{min-width:28px;text-align:center;font-weight:700}
.buy-btn{
  background:linear-gradient(90deg,var(--maroon),#b22222);color:#fff;padding:10px;border-radius:8px;border:none;font-weight:800;
  cursor:pointer;transition:transform .12s,box-shadow .12s;display:block;width:100%;
}
.buy-btn:active{transform:translateY(2px)}
.deal-badge{background:var(--accent);color:#fff;padding:6px 8px;border-radius:6px;font-weight:700;font-size:13px;display:inline-block}

/* cart bar */
.cart-bar{
  position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:linear-gradient(90deg,var(--maroon),#b22222);
  color:white;padding:14px 20px;border-radius:999px;box-shadow:0 10px 30px rgba(0,0,0,0.3);z-index:3000;cursor:pointer;font-weight:800;display:flex;gap:12px;align-items:center
}

/* checkout panel */
.checkout-panel{
  position:fixed;left:0;right:0;bottom:-100%;background:#fff;border-radius:18px 18px 0 0;padding:16px;transition:bottom .35s;z-index:4000;
  max-height:85vh;overflow-y:auto;box-shadow:0 -8px 30px rgba(0,0,0,0.2);
}
.checkout-panel.active{bottom:0}
.checkout-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:8px;border-bottom:1px solid #eee}
.close-btn{background:#eee;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}

/* item details modal/options */
.modal-back{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:5000}
.modal-back.show{display:flex}
.modal{
  background:#fff;width:95%;max-width:900px;border-radius:12px;padding:14px;display:flex;gap:12px;align-items:flex-start;
}
@media(max-width:700px){.modal{flex-direction:column}}
.modal .left{flex:1}
.modal .right{flex:1}
.option-group{margin:10px 0;padding-top:8px;border-top:1px solid #f2f2f2}
.option-group label{display:block;margin:8px 0;font-weight:700}
.option-list{display:flex;flex-wrap:wrap;gap:8px}
.option-item{padding:8px 10px;border-radius:10px;border:1px solid #eee;cursor:pointer}
.option-item.selected{background:var(--maroon);color:#fff;border-color:var(--maroon)}

/* small touches */
.section-sub{color:var(--muted);font-size:13px;margin-bottom:6px}
.hint{font-size:13px;color:var(--muted);margin-top:6px;text-align:center}
.btn-ghost{background:#fff;border:1px solid #eee;padding:8px 12px;border-radius:8px;cursor:pointer}

/* animation for add/buy */
.buy-btn, .cat-btn, .qty-btn{transition:transform .12s,box-shadow .12s}
.buy-btn:hover{box-shadow:0 8px 30px rgba(186,0,0,0.12);transform:translateY(-2px)}

/* small banner under section title */
.section-banner{
  display:inline-block;background:#fff;padding:6px 12px;margin-top:6px;border-radius:6px;border:2px solid rgba(0,0,0,0.03);
  box-shadow:0 6px 18px rgba(0,0,0,0.05)
}
</style>
</head>
<body>

<header>
  <img src="images/logo.png" alt="logo" class="header-logo" id="logoImage">
  <div>
    <div class="header-title">Abdul Hadi <span style="color:var(--muted);font-weight:600">Fast Food</span></div>
    <div class="header-sub">Order online ‚Ä¢ Fast delivery</div>
  </div>
  <div style="margin-left:auto" class="small-actions">
    <button class="btn-ghost" onclick="scrollToSection('deals')">Deals</button>
    <button class="btn-ghost" onclick="scrollToSection('menu')">Menu</button>
  </div>
</header>

<div class="container">

  <!-- categories nav -->
  <div class="categories" id="categoriesNav">
    <button class="cat-btn" onclick="scrollToSection('deals')">Deals üî•</button>
    <button class="cat-btn" onclick="scrollToSection('burgers')">Burgers</button>
    <button class="cat-btn" onclick="scrollToSection('sandwiches')">Sandwiches</button>
    <button class="cat-btn" onclick="scrollToSection('broast')">Broast</button>
    <button class="cat-btn" onclick="scrollToSection('fries')">Fries</button>
    <button class="cat-btn" onclick="scrollToSection('pizza-fries')">Pizza Fries</button>
    <button class="cat-btn" onclick="scrollToSection('boti')">Boti</button>
    <button class="cat-btn" onclick="scrollToSection('kababs')">Kababs</button>
    <button class="cat-btn" onclick="scrollToSection('rolls')">Rolls</button>
    <button class="cat-btn" onclick="scrollToSection('beverages')">Drinks</button>
  </div>

  <!-- DEALS first -->
  <div id="deals" class="section-title" style="margin-top:6px">
    <div class="title section-banner" style="background:linear-gradient(90deg,var(--maroon),#9b1d1d);">üî• Deals</div>
  </div>
  <div class="grid" id="dealsGrid" style="margin-bottom:18px"></div>

  <!-- MENU anchor -->
  <div id="menu" class="section-title">
    <div class="title section-banner">üçΩÔ∏è Full Menu</div>
  </div>

  <!-- Burgers -->
  <div id="burgers" class="section-title" style="margin-top:8px">
    <div class="title">Burgers</div>
  </div>
  <div class="grid" id="burgersGrid"></div>

  <!-- Sandwiches -->
  <div id="sandwiches" class="section-title"><div class="title">Sandwiches</div></div>
  <div class="grid" id="sandwichGrid"></div>

  <!-- Broast -->
  <div id="broast" class="section-title"><div class="title">Broast</div></div>
  <div class="grid" id="broastGrid"></div>

  <!-- Fries -->
  <div id="fries" class="section-title"><div class="title">Fries</div></div>
  <div class="grid" id="friesGrid"></div>

  <!-- Pizza Fries -->
  <div id="pizza-fries" class="section-title"><div class="title">Pizza & Maatka Fries</div></div>
  <div class="grid" id="pizzaFriesGrid"></div>

  <!-- Boti -->
  <div id="boti" class="section-title"><div class="title">Boti</div></div>
  <div class="grid" id="botiGrid"></div>

  <!-- Kababs -->
  <div id="kababs" class="section-title"><div class="title">Barbeque & Kababs</div></div>
  <div class="grid" id="kababGrid"></div>

  <!-- Rolls -->
  <div id="rolls" class="section-title"><div class="title">Rolls</div></div>
  <div class="grid" id="rollGrid"></div>

  <!-- Beverages -->
  <div id="beverages" class="section-title"><div class="title">Beverages</div></div>
  <div class="grid" id="bevGrid"></div>

  <!-- Extras -->
  <div id="extras" class="section-title"><div class="title">Extras & Sauces</div></div>
  <div class="grid" id="extrasGrid"></div>

  <div style="height:90px"></div>
</div>

<!-- cart bar -->
<div class="cart-bar" onclick="openCheckout()">
  üõí <span id="cartCount">0</span> items ‚Äî <span id="cartTotal">Rs. 0</span>
</div>

<!-- checkout panel -->
<div class="checkout-panel" id="checkoutPanel">
  <div class="checkout-header">
    <h3>Your Order</h3>
    <div>
      <button class="close-btn" onclick="closeCheckout()">Close</button>
    </div>
  </div>
  <div id="checkoutList" style="margin-top:12px"></div>
  <div style="text-align:center;margin-top:14px">
    <div id="grandTotal" style="font-weight:800;margin-bottom:10px">Total: Rs. 0</div>
    <button class="buy-btn" onclick="sendOrder()">Order on WhatsApp</button>
  </div>
</div>

<!-- options modal -->
<div class="modal-back" id="modalBack">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="left">
      <img id="modalImg" src="" alt="" style="width:100%;height:250px;object-fit:cover;border-radius:8px">
    </div>
    <div class="right">
      <h2 id="modalName"></h2>
      <div style="font-weight:800;color:var(--accent)" id="modalPrice"></div>
      <div class="option-group" id="modalOptions"></div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <button class="qty-btn" onclick="modalChangeQty(-1)">‚àí</button>
        <div style="min-width:34px;text-align:center;font-weight:800" id="modalQty">1</div>
        <button class="qty-btn" onclick="modalChangeQty(1)">+</button>
        <button class="buy-btn" style="flex:1" onclick="modalConfirmBuy()">Add to Cart</button>
      </div>
      <div class="hint">Select options above (if any) then Add to Cart</div>
    </div>
  </div>
</div>

<script>
/* ====== data ======
  Provide images in images/ folder. Change filenames if needed.
  Options schema: [{type:'radio'|'checkbox'|'size',name:'With Cheese',values:[{label:'Yes',price:50, id:'cheese_yes'}]}]
*/
const whatsappPhone = '03158377135'; // <-- change to your number (no +, country code optional)

const deals = [
  { id:'deal1', name:'Deal 1 ‚Äî Buy 4 Zinger & Get 1 Free', price:1000, items:[{name:'Zinger Burger x5'}], img:'images/deal1.jpg', options:[] },
  { id:'deal2', name:'Deal 2 ‚Äî 2 Zinger + 1 Next Cola(245ml)', price:550, img:'images/deal2.jpg', options:[] },
  { id:'deal3', name:'Deal 3 ‚Äî Zinger + Club + Next Cola 1L', price:600, img:'images/deal3.jpg', options:[] },
  { id:'deal4', name:'Deal 4 ‚Äî 2 Zinger + Free Fries', price:500, img:'images/deal4.jpg', options:[] },
  { id:'deal5', name:'Deal 5 ‚Äî Zinger + Club + 2 Ice Cream', price:750, img:'images/deal5.jpg', options:[] },
  { id:'deal6', name:'Deal 6 ‚Äî 3 Zinger + Next Cola 1L', price:850, img:'images/deal6.jpg', options:[] },
  { id:'deal7', name:'Deal 7 ‚Äî Qtr Broast (Leg) + Club + Zinger', price:800, img:'images/deal7.jpg', options:[] },
  { id:'deal8', name:'Deal 8 ‚Äî 2 Zinger + Club + Chicken Roll', price:850, img:'images/deal8.jpg', options:[] },
  { id:'family', name:'Family Deal', price:2000, img:'images/family.jpg', options:[] }
];

// We'll build menu items per the menu you provided (examples below). Add more as needed.
const menuItems = [
  // Burgers
  {id:'zinger',name:'Zinger Burger',price:250,section:'burgers',img:'images/zinger_burger.jpg', options:[
     {type:'radio',name:'Fries',key:'fries',values:[{label:'Without Fries',price:0},{label:'With Fries',price:50}]},
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'zinger_cheese',name:'Zinger Cheese Burger',price:300,section:'burgers',img:'images/zinger_cheese.jpg', options:[
     {type:'radio',name:'Fries',key:'fries',values:[{label:'Without Fries',price:0},{label:'With Fries',price:50}]}
  ]},
  {id:'mini',name:'Mini Burger',price:200,section:'burgers',img:'images/mini_burger.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'mini_cheese',name:'Mini Burger Cheese',price:250,section:'burgers',img:'images/mini_burger_cheese.jpg', options:[]},
  {id:'jumbo',name:'Jumbo Zinger',price:450,section:'burgers',img:'images/jumbo_zinger.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'chicken_burger',name:'Chicken Burger',price:250,section:'burgers',img:'images/chicken_burger.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'chicken_cheese',name:'Chicken Cheese Burger',price:300,section:'burgers',img:'images/chicken_cheese_burger.jpg', options:[]},
  {id:'beef',name:'Beef Burger',price:300,section:'burgers',img:'images/beef_burger.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'beef_cheese',name:'Beef Cheese Burger',price:350,section:'burgers',img:'images/beef_cheese.jpg', options:[]},
  {id:'towinone',name:'Two in One Burger',price:500,section:'burgers',img:'images/two_in_one.jpg', options:[]},

  // Sandwiches
  {id:'chicken_sandwich',name:'Chicken Sandwich',price:200,section:'sandwiches',img:'images/chicken_sandwich.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'club',name:'Club Sandwich',price:250,section:'sandwiches',img:'images/club_sandwich.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]},
     {type:'radio',name:'Club',key:'club',values:[{label:'Single',price:0},{label:'Double',price:60}]}
  ]},
  {id:'crispy',name:'Crispy Sandwich',price:300,section:'sandwiches',img:'images/crispy_sandwich.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'bbq_sand',name:'BBQ Sandwich',price:350,section:'sandwiches',img:'images/bbq_sandwich.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},
  {id:'malai_sand',name:'Malai Sandwich',price:400,section:'sandwiches',img:'images/malai_sandwich.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'With Cheese',price:50}]}
  ]},

  // Broast
  {id:'qtr_chest',name:'Qtr Broast (Chest)',price:400,section:'broast',img:'images/qtr_chest.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Quarter',price:0},{label:'Full',price:800}]}
  ]},
  {id:'qtr_leg',name:'Qtr Broast (Leg)',price:350,section:'broast',img:'images/qtr_leg.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Quarter',price:0},{label:'Full',price:700}]}
  ]},

  // Fries
  {id:'plain_fries',name:'Plain Fries',price:50,section:'fries',img:'images/plain_fries.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Small',price:50},{label:'Large',price:100}]}
  ]},
  {id:'masala_fries',name:'Masala Fries',price:100,section:'fries',img:'images/masala_fries.jpg', options:[]},
  {id:'mayo_fries',name:'Mayo Fries',price:150,section:'fries',img:'images/mayo_fries.jpg', options:[]},

  // Pizza fries & others with sizes
  {id:'pizza_fries_med',name:'Pizza Fries (Medium)',price:300,section:'pizza-fries',img:'images/pizza_fries_med.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Medium',price:300},{label:'Large',price:400}]}
  ]},
  {id:'matka_fries_med',name:'Matkka Fries (Medium)',price:200,section:'pizza-fries',img:'images/matka_fries_med.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Medium',price:200},{label:'Large',price:450}]}
  ]},
  {id:'chicken_fries_med',name:'Chicken Fries (Medium)',price:250,section:'pizza-fries',img:'images/chicken_fries_med.jpg', options:[
     {type:'radio',name:'Size',key:'size',values:[{label:'Medium',price:250},{label:'Large',price:350}]}
  ]},

  // Boti
  {id:'chicken_boti',name:'Chicken Boti',price:350,section:'boti',img:'images/chicken_boti.jpg', options:[]},
  {id:'beef_boti',name:'Beef Boti',price:450,section:'boti',img:'images/beef_boti.jpg', options:[]},

  // Kababs & barbeque
  {id:'chicken_tikka_chest',name:'Chicken Tikka Chest',price:400,section:'kababs',img:'images/chicken_tikka.jpg', options:[
     {type:'radio',name:'Part',key:'part',values:[{label:'Chest',price:0},{label:'Leg',price:-50}]}
  ]},
  {id:'bihari_boti',name:'Bihari Boti',price:400,section:'kababs',img:'images/bihari_boti.jpg', options:[]},

  // Rolls (with cheese/mayo options)
  {id:'chicken_roll',name:'Chicken Roll',price:160,section:'rolls',img:'images/chicken_roll.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'Cheese',price:40}]},
     {type:'radio',name:'Style',key:'style',values:[{label:'Regular',price:0},{label:'Large',price:40}]}
  ]},
  {id:'zinger_roll',name:'Zinger Roll',price:180,section:'rolls',img:'images/zinger_roll.jpg', options:[
     {type:'radio',name:'Cheese',key:'cheese',values:[{label:'No Cheese',price:0},{label:'Cheese',price:50}]}
  ]},

  // Beverages
  {id:'cold_300',name:'Cold Drink 300ml',price:70,section:'beverages',img:'images/cold_300.jpg', options:[]},
  {id:'cold_500',name:'Cold Drink 500ml',price:100,section:'beverages',img:'images/cold_500.jpg', options:[]},

  // Extras
  {id:'mayo_dip',name:'Mayo Sauce Dip',price:80,section:'extras',img:'images/mayo.jpg', options:[]},
  {id:'ketchup_dip',name:'Ketchup Dip',price:80,section:'extras',img:'images/ketchup.jpg', options:[]},
  {id:'raita',name:'Raita',price:80,section:'extras',img:'images/raita.jpg', options:[]}
];

// simple mapping for section to container id
const sectionMap = {
  burgers: 'burgersGrid',
  sandwiches: 'sandwichGrid',
  broast: 'broastGrid',
  fries: 'friesGrid',
  'pizza-fries': 'pizzaFriesGrid',
  boti: 'botiGrid',
  kababs: 'kababGrid',
  rolls: 'rollGrid',
  beverages: 'bevGrid',
  extras: 'extrasGrid'
};

const imagesFallback = 'data:image/svg+xml;charset=utf-8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="600" height="400"><rect width="100%" height="100%" fill="#eee"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#bbb" font-size="20">Image</text></svg>');

let cart = {}; // cart[id] = {id,name,price,img,qty,selectedOptions:{}}

function createCard(item){
  const hasOptions = item.options && item.options.length>0;
  const imgSrc = item.img || imagesFallback;
  return `
    <div class="card" id="card-${item.id}">
      <img src="${imgSrc}" alt="${escapeHtml(item.name)}" onerror="this.onerror=null;this.src='${imagesFallback}'">
      <div class="name">${escapeHtml(item.name)}</div>
      <div class="price">Rs. ${item.price}</div>
      <div class="controls" id="controls-${item.id}">
        ${hasOptions? `<button class="buy-btn" onclick="openModal('${item.id}')">Buy</button>` :
        `<button class="qty-btn" onclick="changeQty('${item.id}',-1)">‚àí</button>
         <div class="qty-display" id="qty-${item.id}">0</div>
         <button class="qty-btn" onclick="changeQty('${item.id}',1)">+</button>`}
      </div>
    </div>
  `;
}

function renderDeals(){
  const el = document.getElementById('dealsGrid');
  el.innerHTML = '';
  deals.forEach(d=>{
    const img = d.img || imagesFallback;
    el.insertAdjacentHTML('beforeend', `
      <div class="card">
        <img src="${img}" alt="${escapeHtml(d.name)}" onerror="this.onerror=null;this.src='${imagesFallback}'">
        <div class="name">${escapeHtml(d.name)}</div>
        <div class="price">Rs. ${d.price}</div>
        <div class="controls">
          <button class="buy-btn" onclick="dealBuy('${d.id}')">Buy</button>
        </div>
      </div>
    `);
  });
}

function renderMenu(){
  // clear all
  Object.values(sectionMap).forEach(id=>document.getElementById(id).innerHTML='');
  menuItems.forEach(item=>{
    const containerId = sectionMap[item.section];
    if(!containerId) return;
    document.getElementById(containerId).insertAdjacentHTML('beforeend', createCard(item));
  });
}

function changeQty(id, delta){
  const item = menuItems.find(i=>i.id===id);
  if(!item) return;
  if(!cart[id]) cart[id]={...item, qty:0, selectedOptions:{}};
  cart[id].qty = Math.max(0, (cart[id].qty||0) + delta);
  // update qty display(s)
  const qtyEls = document.querySelectorAll(`#qty-${id}`);
  qtyEls.forEach(e=>e.innerText = cart[id].qty);
  // if qty becomes 0, remove from cart object but keep UI zero showing
  if(cart[id].qty===0){
    delete cart[id];
  }
  updateCartUI();
}

function dealBuy(dealId){
  const d = deals.find(x=>x.id===dealId);
  if(!d) return;
  // for deals we just add with qty 1
  const id = `deal_${dealId}`;
  cart[id] = {id, name:d.name, price:d.price, img:d.img, qty: (cart[id]?.qty||0)+1, selectedOptions:{}};
  updateCartUI();
  openCheckout();
}

/* ====== modal (options) ====== */
let modalState = {currentItem:null, qty:1, selected:{}};
function openModal(itemId){
  const item = menuItems.find(i=>i.id===itemId);
  if(!item) return;
  modalState = {currentItem:item, qty:1, selected:{}};
  document.getElementById('modalImg').src = item.img || imagesFallback;
  document.getElementById('modalName').innerText = item.name;
  document.getElementById('modalPrice').innerText = `Rs. ${item.price}`;
  const optionsDiv = document.getElementById('modalOptions'); optionsDiv.innerHTML='';
  if(item.options && item.options.length){
    item.options.forEach((opt,oi)=>{
      const wrapper = document.createElement('div');
      wrapper.innerHTML = `<label>${escapeHtml(opt.name)}</label>`;
      const list = document.createElement('div'); list.className='option-list';
      opt.values.forEach((val,vi)=>{
        const btn = document.createElement('div');
        btn.className='option-item';
        btn.innerText = `${val.label}${val.price? ' + Rs. '+val.price : ''}`;
        btn.onclick = ()=>{ // handle selection
          if(opt.type==='radio' || opt.type==='size'){
            // clear other
            Array.from(list.children).forEach(c=>c.classList.remove('selected'));
            btn.classList.add('selected');
            modalState.selected[opt.key || opt.name] = val;
          } else if(opt.type==='checkbox'){
            btn.classList.toggle('selected');
            // track multiple
            const arr = modalState.selected[opt.key] || [];
            if(btn.classList.contains('selected')) arr.push(val); else {
              const idx = arr.findIndex(a=>a.label===val.label);
              if(idx>=0) arr.splice(idx,1);
            }
            modalState.selected[opt.key || opt.name] = arr;
          }
        };
        list.appendChild(btn);
      });
      wrapper.appendChild(list);
      optionsDiv.appendChild(wrapper);
    });
  } else {
    optionsDiv.innerHTML = '<div class="hint">No extra options for this item</div>';
  }
  document.getElementById('modalQty').innerText = modalState.qty;
  document.getElementById('modalBack').classList.add('show');
}

function modalChangeQty(delta){
  modalState.qty = Math.max(1, modalState.qty + delta);
  document.getElementById('modalQty').innerText = modalState.qty;
}
function modalConfirmBuy(){
  const it = modalState.currentItem;
  if(!it) return;
  const id = it.id;
  const selectedOptions = modalState.selected || {};
  // price calculation
  let optExtra=0;
  Object.values(selectedOptions).forEach(s=>{
    if(Array.isArray(s)){
      s.forEach(v=>{ optExtra += v.price || 0 });
    } else {
      optExtra += s.price || 0;
    }
  });
  const finalPrice = it.price + optExtra;
  if(!cart[id]) cart[id] = {...it, qty:0, selectedOptions:{}};
  cart[id].qty += modalState.qty;
  cart[id].price = it.price; // keep base price; use selectedOptions when sending message
  cart[id].selectedOptions = selectedOptions;
  // close modal
  closeModal();
  updateCartUI();
}

function closeModal(){
  document.getElementById('modalBack').classList.remove('show');
}

/* ===== cart UI/update and checkout ===== */
function updateCartUI(){
  // update count and total
  let count=0, total=0;
  Object.values(cart).forEach(it=>{
    count += it.qty;
    // estimate price including selected options
    let optExtra=0;
    if(it.selectedOptions){
      Object.values(it.selectedOptions).forEach(s=>{
        if(Array.isArray(s)){ s.forEach(v=>optExtra += (v.price||0)); }
        else optExtra += (s.price||0);
      });
    }
    total += it.qty * ( (it.price||0) + optExtra );
  });
  document.getElementById('cartCount').innerText = count;
  document.getElementById('cartTotal').innerText = 'Rs. '+total;
  document.getElementById('grandTotal').innerText = 'Total: Rs. '+total;

  // checkout list
  const box = document.getElementById('checkoutList'); box.innerHTML='';
  if(Object.keys(cart).length===0){ box.innerHTML = '<p style="text-align:center;color:var(--muted)">Your cart is empty.</p>'; return; }
  Object.values(cart).forEach(it=>{
    const optLines = [];
    if(it.selectedOptions){
      Object.entries(it.selectedOptions).forEach(([k,v])=>{
        if(Array.isArray(v)) v.forEach(vv=>optLines.push(`${k}: ${vv.label}`));
        else optLines.push(`${k}: ${v.label}`);
      });
    }
    box.insertAdjacentHTML('beforeend', `
      <div style="display:flex;gap:12px;align-items:center;padding:10px 0;border-bottom:1px dashed #eee">
        <img src="${it.img||imagesFallback}" style="width:80px;height:64px;object-fit:cover;border-radius:8px" onerror="this.onerror=null;this.src='${imagesFallback}'">
        <div style="flex:1">
          <div style="font-weight:800">${escapeHtml(it.name)}</div>
          <div style="color:var(--muted);font-size:13px">${optLines.join(', ')}</div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <button class="qty-btn" onclick="directChangeQty('${it.id}',-1)">‚àí</button>
            <div style="min-width:30px;text-align:center;font-weight:800">${it.qty}</div>
            <button class="qty-btn" onclick="directChangeQty('${it.id}',1)">+</button>
          </div>
        </div>
        <div style="font-weight:800">Rs. ${computeItemTotal(it)}</div>
      </div>
    `);
  });
}

function computeItemTotal(it){
  let optExtra=0;
  if(it.selectedOptions){
    Object.values(it.selectedOptions).forEach(s=>{
      if(Array.isArray(s)) s.forEach(v=>optExtra += v.price||0);
      else optExtra += s.price||0;
    });
  }
  return ( (it.price||0) + optExtra ) * it.qty;
}

function directChangeQty(id,delta){
  if(!cart[id]) return;
  cart[id].qty = Math.max(0, cart[id].qty + delta);
  if(cart[id].qty===0) delete cart[id];
  updateCartUI();
}

/* open/close checkout & scrolling */
function openCheckout(){ document.getElementById('checkoutPanel').classList.add('active'); }
function closeCheckout(){ document.getElementById('checkoutPanel').classList.remove('active'); }
function scrollToSection(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:'smooth',block:'start'});
}

/* WhatsApp order formatting as bullet list points (each line) */
function sendOrder(){
  if(Object.keys(cart).length===0){ alert('Your cart is empty!'); return; }
  let lines = [];
  lines.push('Assalam o Alaikum, I want to place this order:');
  Object.values(cart).forEach(it=>{
    let optText='';
    if(it.selectedOptions){
      const arr=[];
      Object.entries(it.selectedOptions).forEach(([k,v])=>{
        if(Array.isArray(v)) v.forEach(vv=>arr.push(`${k}: ${vv.label}`));
        else arr.push(`${k}: ${v.label}`);
      });
      if(arr.length) optText = ' ('+arr.join(', ')+')';
    }
    lines.push(`‚Ä¢ ${it.name} x${it.qty}${optText} = Rs ${computeItemTotal(it)}`);
  });
  // totals
  let total=0; Object.values(cart).forEach(it=> total += computeItemTotal(it));
  lines.push(`Total: Rs ${total}`);
  lines.push('Name: ');
  lines.push('Phone: ');
  lines.push('Address: ');
  const text = encodeURIComponent(lines.join('%0A'));
  window.open(`https://wa.me/${whatsappPhone}?text=${text}`,'_blank');
}

/* helper */
function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

/* on load */
renderDeals();
renderMenu();
updateCartUI();

/* close modal on background click */
document.getElementById('modalBack').addEventListener('click', function(e){
  if(e.target === this) closeModal();
});
</script>
</body>
</html>
